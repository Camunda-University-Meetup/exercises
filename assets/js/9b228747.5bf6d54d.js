"use strict";(self.webpackChunkcamunda_exercises=self.webpackChunkcamunda_exercises||[]).push([[483],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(a),h=r,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||o;return a?n.createElement(m,i(i({ref:t},u),{},{components:a})):n.createElement(m,i({ref:t},u))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9512:function(e,t,a){a.r(t),a.d(t,{default:function(){return p},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],s={sidebar_position:2},l={unversionedId:"camunda-7/tasks/service-task/service-task-coding",id:"camunda-7/tasks/service-task/service-task-coding",isDocsHomePage:!1,title:"Service Task - Coding",description:"Take a look at the following age verification process:",source:"@site/docs/camunda-7/tasks/service-task/service-task-coding.mdx",sourceDirName:"camunda-7/tasks/service-task",slug:"/camunda-7/tasks/service-task/service-task-coding",permalink:"/exercises/camunda-7/tasks/service-task/service-task-coding",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Serivce Task - Low-Code",permalink:"/exercises/camunda-7/tasks/service-task/service-task-low-code"},next:{title:"Exclusive Gateway",permalink:"/exercises/camunda-7/gateways/exclusive-gateway"}},c=[{value:"Variables",id:"variables",children:[]},{value:"Automation",id:"automation",children:[{value:"Delegates",id:"delegates",children:[]},{value:"External tasks",id:"external-tasks",children:[]}]}],u={toc:c};function p(e){var t=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Take a look at the following age verification process:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Age verification process",src:a(4409).Z})),(0,o.kt)("p",null,"You can download the bpmn diagram ",(0,o.kt)("a",{target:"_blank",href:"/assets/docs/service-task/coding/age-verification.bpmn",download:"age-verification.bpmn"},"here"),"."),(0,o.kt)("p",null,"Let's say you are working in a liquor store and a suspiciously young looking guy wants to buy a bottle of Whiskey. You'll have to start a process to verify his age. At first you take a look at his ID in order to figure out his birthdate. Afterwards you'll calculate his age and ultimately check the data you have created during this process."),(0,o.kt)("p",null,"In this exercise, you'll learn how to automate tasks. In our example we will automate the \"Calculate age\" task. But first, let's have a look at which information has to be provided and processed at which task."),(0,o.kt)("h2",{id:"variables"},"Variables"),(0,o.kt)("p",null,"Open the Camunda app, navigate to the Tasklist and start a new ",(0,o.kt)("em",{parentName:"p"},"age_verification"),' process instance.\nClaim the appearing "Figure out birthdate"-task and enter a birthdate of your choice to the form.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Figure out birthdate",src:a(2982).Z})),(0,o.kt)("p",null,'After you have completed the first task, open the appearing "Calculate age"-task, claim it and click "load variables". You\'ll see the first variable ',(0,o.kt)("em",{parentName:"p"},"birthdate"),' and the value you entered to the form. Manually add a variable called "age", pass the age you have calculated and hit "complete". The review task let\'s you review the data and your calculations... You don\'t really benefit from that function at this point, but as soon as you have automated the "Calculate age"-task, this will give you the chance to ensure your code did what it was supposed to do.\nThe creation and consumption of variables looks like this:'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Input output variables",src:a(3415).Z})),(0,o.kt)("p",null,"Both variables, ",(0,o.kt)("em",{parentName:"p"},"birthdate")," and ",(0,o.kt)("em",{parentName:"p"},"age"),', are defined as global process variables at this point. In order to provide some reusability for your BPMN-elements and design them robust enough to perform in larger processes, we will map the variables as input- and Output-variables. Although this is not mandatory for our simple process, you will benefit from following this best practice when you start to work with processes that contain several subprocesses, where variables are reused several times in different scopes.\nTo introduce the variables locally, open the Camunda Modeler and navigate to the "Input/Output"-tab of the "Calculate Age"-task and enter the the corresponding values.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Modeler variables",src:a(4328).Z})),(0,o.kt)("h2",{id:"automation"},"Automation"),(0,o.kt)("h3",{id:"delegates"},"Delegates"),(0,o.kt)("p",null,'Next, cast the task to a servicetask, open the "General"-tab in the Properties Panel and and choose "Delegate Expression" in the "Implementation"-filed. The code for this delegate is already included in the exercise-application project. Enter'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"${ageCalculationDelegate}\n")),(0,o.kt)("p",null,'in the "Delegate Expression" textfield, to call it as soon as the task is started.\nNow redeploy your process and test the execution. Did the servicetask calculate the age correctly?'),(0,o.kt)("p",null,"(If you're tired of entering all the properties manually, you can also download the ",(0,o.kt)("a",{target:"_blank",href:"/assets/docs/service-task/coding/age-calculation-template.json",download:"age-calculation-template.json"},"Element-Template")," from this folder, store it locally in your camunda-modeler-templates-folder as described in the ",(0,o.kt)("a",{parentName:"p",href:"/camunda-7/tasks/service-task/service-task-low-code"},"Service - Low-Code")," example and simply select the template)"),(0,o.kt)("p",null,'If everything is working, try to switch the "Check data"-task to a servicetask aswell. Use this template for the new Java class and let the method print the birthdate and the calculated age in the console. Check the "AgeCalculationDelegate.java" class to find out which methods are used to fetch the fetch the required input.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Component("yourDelegateName")\n@RequiredArgsConstructor\npublic class YourDelegateName implements JavaDelegate {\n  @Override\n  public void execute(DelegateExecution execution) throws Exception{\n  //input:\n\n  //processing:\n  System.out.println("Age and birthdate here");\n\n  //output:\n\n  }\n}\n')),(0,o.kt)("h3",{id:"external-tasks"},"External tasks"),(0,o.kt)("p",null,"Delegate Expressions allow you to automate tasks by coding the business logic directly into your local project. But let's say you want to outsource some tasks or have to set up an information exchange across company borders. In this case you will make use of the ",(0,o.kt)("em",{parentName:"p"},"External"),' servicetasks.\nIn order to give you an idea how to do this, we will just use our age verification process and make the "Calculate age" task an external task. Therefore, open the Camunda Modeler and change the implementation of the task to "External". This allows the task to be fetched from the API - as soon as its execution is started by the process engine. And in order to fetch it, we will need to build a client.'),(0,o.kt)("p",null,"Have a look at the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.camunda.org/manual/latest/user-guide/ext-client/spring-boot-starter/"},"Camunda Docs")," for detailed information about external tasks and the capabilities of the Camunda framework."),(0,o.kt)("p",null,"In order to build a client, you have to use the ",(0,o.kt)("em",{parentName:"p"},"ExternalTaskClient")," interface, provided by the Camunda library, to specify the API and then subscribe the client to a specific task of your process.\nA skeleton of an external client looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'//build the client by passing the entry point to the Java API and providing a timeout duration\nExternalTaskClient client = ExternalTaskClient.create()\n        .baseUrl("http://localhost:8080/engine-rest")\n        .asyncResponseTimeout(10 * 1000)\n        .build();\n\n//subscribe to an external task by specifying the "topic"-description as in the diagram\nclient.subscribe("taskName")\n        .lockDuration(50 * 1000)\n        .handler((externalTask, externalTaskService) -> {\n\n            //Fetch the variables:\n            String variable = (String) externalTask.getVariable("variableName");\n\n            /*\n            Add your business logic here\n             */\n\n            externalTaskService.complete(externalTask, variables);\n            })\n        .open();\n')),(0,o.kt)("p",null,"Try to implement the client and check if it fetches the external task.\nA sample project containing a client that is configured to fetch the ",(0,o.kt)("em",{parentName:"p"},"calculateAge")," task from the age verification process can be found here:\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/camunda-university-meetup/externalWorker.git"},"ExternalWorker")))}p.isMDXComponent=!0},4409:function(e,t,a){t.Z=a.p+"assets/images/age-verification-process-bfe6afb8732d2027a77ad68f26f2af60.png"},2982:function(e,t,a){t.Z=a.p+"assets/images/claim-fbf819b8232a5207fbe3006062594274.png"},3415:function(e,t,a){t.Z=a.p+"assets/images/input-output-variables-962c615409b63401d18b1f954aa11d0f.png"},4328:function(e,t,a){t.Z=a.p+"assets/images/modeler-variables-1a24533d5e09ea800f834647372963f8.png"}}]);