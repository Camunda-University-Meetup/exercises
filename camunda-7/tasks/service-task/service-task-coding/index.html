<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/exercises/blog/rss.xml" title="Camunda Exercises Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/exercises/blog/atom.xml" title="Camunda Exercises Blog Atom Feed"><title data-react-helmet="true">Service Task - Coding | Camunda Exercises</title><meta data-react-helmet="true" property="og:url" content="https://camunda-university-meetup.github.io/exercises/camunda-7/tasks/service-task/service-task-coding"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service Task - Coding | Camunda Exercises"><meta data-react-helmet="true" name="description" content="Take a look at the following age verification process:"><meta data-react-helmet="true" property="og:description" content="Take a look at the following age verification process:"><link data-react-helmet="true" rel="shortcut icon" href="/exercises/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://camunda-university-meetup.github.io/exercises/camunda-7/tasks/service-task/service-task-coding"><link data-react-helmet="true" rel="alternate" href="https://camunda-university-meetup.github.io/exercises/camunda-7/tasks/service-task/service-task-coding" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://camunda-university-meetup.github.io/exercises/camunda-7/tasks/service-task/service-task-coding" hreflang="x-default"><link rel="stylesheet" href="/exercises/assets/css/styles.8565d999.css">
<link rel="preload" href="/exercises/assets/js/runtime~main.442c517f.js" as="script">
<link rel="preload" href="/exercises/assets/js/main.3a97c9c3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/exercises/"><img src="/exercises/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/exercises/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Camunda Exercises</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/camunda-university-meetup/exercises" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/exercises/"><img src="/exercises/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/exercises/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Camunda Exercises</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/camunda-university-meetup/exercises" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/exercises/">Intro</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Camunda 7</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/exercises/camunda-7/">Intro</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Tasks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/exercises/camunda-7/tasks/user-task">User Task</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Service Task</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/exercises/camunda-7/tasks/service-task/service-task-low-code">Serivce Task - Low-Code</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/exercises/camunda-7/tasks/service-task/service-task-coding">Service Task - Coding</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Gateways</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/gateways/exclusive-gateway">Exclusive Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/gateways/parallel-gateway">Parallel Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/gateways/inclusive-gateway">Inclusive Gateway</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/events/timer-event">Timer Event</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/events/message-event">Message Event</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/events/event-based-gateway">Event-based-Gateway</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Call Activity</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/call-activity/call-activity">Order Process</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Attached boundary events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/attached-boundary-events/interrupting">Interrupting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/attached-boundary-events/none-interrupting">Non-Interrupting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Instructions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-7/instructions/deploying-diagrams">Deploying diagrams</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Camunda 8</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-8/">Intro</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Tasks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-8/tasks/user-task">User Task</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/exercises/camunda-8/tasks/service-task">Service Task</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Service Task - Coding</h1></header><div class="markdown"><p>Take a look at the following age verification process:</p><p><img alt="Age verification process" src="/exercises/assets/images/age-verification-process-bfe6afb8732d2027a77ad68f26f2af60.png"></p><p>You can download the bpmn diagram <a target="_blank" download="age-verification.bpmn" href="/exercises/assets/docs/service-task/coding/age-verification.bpmn">here</a>.</p><p>Let&#x27;s say you are working in a liquor store and a suspiciously young looking guy wants to buy a bottle of Whiskey. You&#x27;ll have to start a process to verify his age. At first you take a look at his ID in order to figure out his birthdate. Afterwards you&#x27;ll calculate his age and ultimately check the data you have created during this process.</p><p>In this exercise, you&#x27;ll learn how to automate tasks. In our example we will automate the &quot;Calculate age&quot; task. But first, let&#x27;s have a look at which information has to be provided and processed at which task.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="variables"></a>Variables<a class="hash-link" href="#variables" title="Direct link to heading">#</a></h2><p>Open the Camunda app, navigate to the Tasklist and start a new <em>age_verification</em> process instance.
Claim the appearing &quot;Figure out birthdate&quot;-task and enter a birthdate of your choice to the form.</p><p><img alt="Figure out birthdate" src="/exercises/assets/images/claim-fbf819b8232a5207fbe3006062594274.png"></p><p>After you have completed the first task, open the appearing &quot;Calculate age&quot;-task, claim it and click &quot;load variables&quot;. You&#x27;ll see the first variable <em>birthdate</em> and the value you entered to the form. Manually add a variable called &quot;age&quot;, pass the age you have calculated and hit &quot;complete&quot;. The review task let&#x27;s you review the data and your calculations... You don&#x27;t really benefit from that function at this point, but as soon as you have automated the &quot;Calculate age&quot;-task, this will give you the chance to ensure your code did what it was supposed to do.
The creation and consumption of variables looks like this:</p><p><img alt="Input output variables" src="/exercises/assets/images/input-output-variables-962c615409b63401d18b1f954aa11d0f.png"></p><p>Both variables, <em>birthdate</em> and <em>age</em>, are defined as global process variables at this point. In order to provide some reusability for your BPMN-elements and design them robust enough to perform in larger processes, we will map the variables as input- and Output-variables. Although this is not mandatory for our simple process, you will benefit from following this best practice when you start to work with processes that contain several subprocesses, where variables are reused several times in different scopes.
To introduce the variables locally, open the Camunda Modeler and navigate to the &quot;Input/Output&quot;-tab of the &quot;Calculate Age&quot;-task and enter the the corresponding values.</p><p><img alt="Modeler variables" src="/exercises/assets/images/modeler-variables-1a24533d5e09ea800f834647372963f8.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="automation"></a>Automation<a class="hash-link" href="#automation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="delegates"></a>Delegates<a class="hash-link" href="#delegates" title="Direct link to heading">#</a></h3><p>Next, cast the task to a servicetask, open the &quot;General&quot;-tab in the Properties Panel and and choose &quot;Delegate Expression&quot; in the &quot;Implementation&quot;-filed. The code for this delegate is already included in the exercise-application project. Enter</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">${ageCalculationDelegate}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>in the &quot;Delegate Expression&quot; textfield, to call it as soon as the task is started.
Now redeploy your process and test the execution. Did the servicetask calculate the age correctly?</p><p>(If you&#x27;re tired of entering all the properties manually, you can also download the <a target="_blank" download="age-calculation-template.json" href="/exercises/assets/docs/service-task/coding/age-calculation-template.json">Element-Template</a> from this folder, store it locally in your camunda-modeler-templates-folder as described in the <a href="/exercises/camunda-7/tasks/service-task/service-task-low-code">Service - Low-Code</a> example and simply select the template)</p><p>If everything is working, try to switch the &quot;Check data&quot;-task to a servicetask aswell. Use this template for the new Java class and let the method print the birthdate and the calculated age in the console. Check the &quot;AgeCalculationDelegate.java&quot; class to find out which methods are used to fetch the fetch the required input.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Component(&quot;yourDelegateName&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@RequiredArgsConstructor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class YourDelegateName implements JavaDelegate {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public void execute(DelegateExecution execution) throws Exception{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //input:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //processing:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  System.out.println(&quot;Age and birthdate here&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //output:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="external-tasks"></a>External tasks<a class="hash-link" href="#external-tasks" title="Direct link to heading">#</a></h3><p>Delegate Expressions allow you to automate tasks by coding the business logic directly into your local project. But let&#x27;s say you want to outsource some tasks or have to set up an information exchange across company borders. In this case you will make use of the <em>External</em> servicetasks.
In order to give you an idea how to do this, we will just use our age verification process and make the &quot;Calculate age&quot; task an external task. Therefore, open the Camunda Modeler and change the implementation of the task to &quot;External&quot;. This allows the task to be fetched from the API - as soon as its execution is started by the process engine. And in order to fetch it, we will need to build a client.</p><p>Have a look at the <a href="https://docs.camunda.org/manual/latest/user-guide/ext-client/spring-boot-starter/" target="_blank" rel="noopener noreferrer">Camunda Docs</a> for detailed information about external tasks and the capabilities of the Camunda framework.</p><p>In order to build a client, you have to use the <em>ExternalTaskClient</em> interface, provided by the Camunda library, to specify the API and then subscribe the client to a specific task of your process.
A skeleton of an external client looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//build the client by passing the entry point to the Java API and providing a timeout duration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExternalTaskClient client = ExternalTaskClient.create()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .baseUrl(&quot;http://localhost:8080/engine-rest&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .asyncResponseTimeout(10 * 1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .build();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//subscribe to an external task by specifying the &quot;topic&quot;-description as in the diagram</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">client.subscribe(&quot;taskName&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .lockDuration(50 * 1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .handler((externalTask, externalTaskService) -&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            //Fetch the variables:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            String variable = (String) externalTask.getVariable(&quot;variableName&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            /*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Add your business logic here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            externalTaskService.complete(externalTask, variables);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .open();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Try to implement the client and check if it fetches the external task.
A sample project containing a client that is configured to fetch the <em>calculateAge</em> task from the age verification process can be found here:
<a href="https://github.com/camunda-university-meetup/externalWorker.git" target="_blank" rel="noopener noreferrer">ExternalWorker</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/exercises/camunda-7/tasks/service-task/service-task-low-code"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Serivce Task - Low-Code</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/exercises/camunda-7/gateways/exclusive-gateway"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Exclusive Gateway Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#variables" class="table-of-contents__link">Variables</a></li><li><a href="#automation" class="table-of-contents__link">Automation</a><ul><li><a href="#delegates" class="table-of-contents__link">Delegates</a></li><li><a href="#external-tasks" class="table-of-contents__link">External tasks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/exercises/camunda-7/instructions/deploying-diagrams">Instructions</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://forum.camunda.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Camunda Forum</a></li><li class="footer__item"><a href="https://www.meetup.com/de-DE/camunda-university-group/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Camunda University Meetup</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/camunda-community-hub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 FlowSquad GmbH</div></div></div></footer></div>
<script src="/exercises/assets/js/runtime~main.442c517f.js"></script>
<script src="/exercises/assets/js/main.3a97c9c3.js"></script>
</body>
</html>